# Kibana Apache Virtual Host
#
# Generated by Chef

<% if !node['apache']['listen_ports'].include?(node['kibana']['apache']['port'].to_s) %>
NameVirtualHost <%= node['kibana']['apache']['interface'] %>:<%= node['kibana']['apache']['port'] %>
<% end -%>
<VirtualHost <%= node['kibana']['apache']['interface'] %>:<%= node['kibana']['apache']['port'] %>>

  ServerName <%= node['kibana']['apache']['host'] %>
  ServerAlias <%= node['kibana']['apache']['host'] %>

  <% if node['kibana']['apache']['basic_auth'] == 'on' %>

    <Location "/">
      Order allow,deny
      Allow from all
      AuthType basic
      AuthName "Kibana"
      AuthBasicProvider file
      AuthUserFile <%= node['apache']['dir'] %>/htpasswd
      require valid-user
    </Location>

  <% else %>

    <Location "/">
      Order allow,deny
      Allow from all
      SetHandler None
    </Location>

  <% end %>

  ProxyPass              /  http://<%= node['kibana']['interface'] %>:<%= node['kibana']['port'] %>/
  ProxyPassReverse       /  http://<%= node['kibana']['interface'] %>:<%= node['kibana']['port'] %>/
</VirtualHost>
